From bdc8111886beb8759f466f52094c43c97168cc13 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=3D=3FUTF-8=3Fq=3F=3DE3=3D84=3D97=3DE3=3D84=3DA0=3DCB=3D8B?=
 =?UTF-8?q?=3D20=3DE3=3D84=3D91=3DE3=3D84=3DA7=3DCB=3D8A=3F=3D?=
 <tsao-chi@the-lingo.org>
Date: Thu, 2 Apr 2020 11:16:18 +0800
Subject: [PATCH] Implement [Akarin-0010] Save Json list asynchronously


diff --git a/src/main/java/net/minecraft/server/JsonList.java b/src/main/java/net/minecraft/server/JsonList.java
index 8e4ecfd64..fd371f03a 100644
--- a/src/main/java/net/minecraft/server/JsonList.java
+++ b/src/main/java/net/minecraft/server/JsonList.java
@@ -13,6 +13,7 @@ import com.google.gson.JsonObject;
 import com.google.gson.JsonParseException;
 import com.google.gson.JsonSerializationContext;
 import com.google.gson.JsonSerializer;
+import ga.windpvp.windspigot.async.AsyncUtil;
 import java.io.BufferedReader;
 import java.io.BufferedWriter;
 import java.io.File;
@@ -150,17 +151,21 @@ public class JsonList<K, V extends JsonListEntry<K>> {
     }
 
     public void save() throws IOException {
-        Collection collection = this.d.values();
-        String s = this.b.toJson(collection);
-        BufferedWriter bufferedwriter = null;
-
-        try {
-            bufferedwriter = Files.newWriter(this.c, Charsets.UTF_8);
-            bufferedwriter.write(s);
-        } finally {
-            IOUtils.closeQuietly(bufferedwriter);
-        }
-
+        Runnable runnable = () -> { // Akarin - Save json list async
+            Collection collection = this.d.values();
+            String s = this.b.toJson(collection);
+            BufferedWriter bufferedwriter = null;
+
+            try {
+                bufferedwriter = Files.newWriter(this.c, Charsets.UTF_8);
+                bufferedwriter.write(s);
+            } catch (IOException ex) { // Akarin
+                JsonList.a.warn("Failed to save " + this.c, ex); // Akarin
+            } finally {
+                IOUtils.closeQuietly(bufferedwriter);
+            }
+        }; // Akarin
+        AsyncUtil.run(runnable); // Akarin
     }
 
     public void load() throws FileNotFoundException {
-- 
2.36.0.windows.1

